<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘å¤œå›ä¸´åœ°å›¾ç­›é€‰</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="description" content="åŸºäºå…´è¶£ç‚¹ä½ç½®è¯†åˆ«ã€Šè‰¾å°”ç™»æ³•ç¯:é»‘å¤œå›ä¸´ã€‹åœ°å›¾ç§å­çš„äº¤äº’å¼å·¥å…·">
    <meta name="keywords" content="è‰¾å°”ç™»æ³•ç¯, é»‘å¤œå›ä¸´, åœ°å›¾, ç§å­, è¯†åˆ«, å…´è¶£ç‚¹, å·¥å…·">
    <link rel="icon" href="favicon.ico">
    <!-- Vercount PV/UV ç»Ÿè®¡è„šæœ¬ -->
    <script defer src="https://events.vercount.one/js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="button-row">
                <button id="help-btn" class="help-btn tooltip" aria-label="ä½¿ç”¨æ•™ç¨‹" data-tooltip="ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨æ•™ç¨‹">
                    <img src="favicon.ico" alt="ä½¿ç”¨æ•™ç¨‹" class="help-icon">
                </button>
            </div>
            <!-- ======================= -->
            <div class="top-actions">
                <button id="action-quickref" class="action-btn" title="ç‚¹å‡»è·³è½¬ã€é»‘å¤œå›ä¸´é€ŸæŸ¥æ‰‹å†Œã€‘">
                    <img src="assets/icons/window-stack.svg" alt="é€ŸæŸ¥æ‰‹å†Œ">
                </button>
                <button id="action-stats" class="action-btn" title="æŸ¥çœ‹è®¿é—®é‡">
                    <img src="assets/icons/fire.svg" alt="è®¿é—®é‡">
                </button>
                <button id="action-english-web" class="action-btn" title="æŸ¥çœ‹è‹±æ–‡ç‰ˆåŸç½‘ç«™">
                    <img src="assets/icons/box-arrow-in-up-right.svg" alt="æŸ¥çœ‹è‹±æ–‡ç‰ˆåŸç½‘ç«™">
                </button>
                <button id="action-map-source" class="action-btn" title="åœ°å›¾æ•°æ®æ¥æº">
                    <img src="assets/icons/pin-map-fill.svg" alt="åœ°å›¾æ•°æ®æ¥æº">
                </button>
                <button id="action-repo" class="action-btn" title="æŸ¥çœ‹é¡¹ç›®">
                    <img src="assets/icons/github.svg" alt="æŸ¥çœ‹é¡¹ç›®">
                </button>
                <!-- <button id="action-tbd" class="action-btn" title="å¾…å®š">
                    <i class="fas fa-ellipsis"></i>
                </button> -->
                <div id="stats-popover" class="actions-popover" style="display: none;">
                    <div class="popover-title">
                        ğŸ”¥ è®¿é—®é‡ç»Ÿè®¡
                    </div>
                    <div class="popover-body">
                        æœ¬ç«™æ€»è®¿å®¢æ•°: <span id="vercount_value_site_uv">Loading</span> äºº<br>
                        æœ¬ç«™æ€»è®¿é—®é‡: <span id="vercount_value_site_pv">Loading</span> æ¬¡<br>
                        åœ°å›¾ç­›é€‰é¡µè®¿é—®é‡: <span id="vercount_value_page_pv">Loading</span> æ¬¡<br>
                        <div class="popover-meta" style="border-top: 1px solid #4fc3f7; padding-top: 8px;">ç»Ÿè®¡æœåŠ¡ï¼šVercount</div>
                    </div>
                </div>
                <div id="repo-popover" class="actions-popover" style="display: none;">
                    <div class="popover-inner">
                        <div class="popover-title">
                            ğŸŒŸé¡¹ç›®ä¿¡æ¯
                        </div>
                        <div class="popover-body">
                            æœ¬ç«™GitHubä»“åº“
                            <a
                            href="https://github.com/xxiixi/NightreignMapFilter"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="footer-link"
                        >
                            ç‚¹å‡»è·³è½¬
                        </a>
                        </div>
                        <div class="popover-body">
                            æå‡ºissue
                            <a
                            href="https://github.com/xxiixi/NightreignMapFilter/issues"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="footer-link"
                        >
                            ç‚¹å‡»è·³è½¬
                        </a>
                        </div>
                        <div class="popover-meta" style="border-top: 1px solid #4fc3f7; padding-top: 8px;"> <i class="fab fa-github"></i> @Cecilia</div>
                    </div>
                </div>
                <div id="english-popover" class="actions-popover" style="display: none;">
                    <div class="popover-inner">
                        <div class="popover-title">
                            ğŸ”— è‹±æ–‡ç‰ˆåŸç½‘ç«™
                        </div>
                        <div class="popover-body">
                            <a href="https://thanosapollo.github.io/nightreign-mapseed-recogniser/" target="_blank" rel="noopener noreferrer" class="footer-link">ç‚¹å‡»æŸ¥çœ‹è‹±æ–‡ç‰ˆåŸç½‘ç«™</a>
                        </div>
                        <div class="popover-meta" style="border-top: 1px solid #4fc3f7; padding-top: 8px;"> <i class="fab fa-github"></i> @thanosapollo</div>
                    </div>
                </div>
                <div id="map-source-popover" class="actions-popover" style="display: none;">
                    <div class="popover-inner">
                        <div class="popover-title">
                            ğŸ“’ åœ°å›¾æ•°æ®æ¥æº
                        </div>
                        <div class="popover-body">
                            <a href="https://www.bilibili.com/video/BV1xGe1zrEED/?spm_id_from=333.337.search-card.all.click&vd_source=37640654dbdd4ab80b471a16ac6da3c0" target="_blank" rel="noopener noreferrer" class="footer-link">é»‘å¤œå›ä¸´-åœ°å›¾ç­›é€‰å™¨</a>
                        </div>
                        <div class="popover-meta" style="border-top: 1px solid #4fc3f7; padding-top: 8px; display: flex; align-items: center; justify-content: center;">
                            <img src="assets/icons/bilibili.svg" style="width: 16px; height: 16px;filter: brightness(0) invert(1);"> @Fuwish
                        </div>
                    </div>
                </div>
                <!-- <div id="tbd-popover" class="actions-popover" style="display: none;">
                    <div class="popover-inner">
                        <div class="popover-title">ğŸ§ª åŠŸèƒ½é¢„è§ˆ</div>
                        <div class="popover-body">æ­¤åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…</div>
                        <div class="popover-body">
                            <a href="https://github.com/xxiixi/NightreignMapFilter/issues" target="_blank" rel="noopener noreferrer" class="footer-link">æäº¤ issue / æƒ³æ³•</a>
                        </div>
                        <div class="popover-meta" style="border-top: 1px solid #4fc3f7; padding-top: 8px;">NightreignMapFilter</div>
                    </div>
                </div> -->
            </div>

            <!-- ======================= -->
            <h1 class="title">
                <i class="fas fa-map"></i>
                é»‘å¤œå›ä¸´åœ°å›¾ç§å­ç­›é€‰å™¨
            </h1>
            <div class="subtitle">
                <p class="version">Version 1.0 | Nightreign version 1.01.3</p>
                <span id="cv-status" style="font-size: 12px;"></span>
            </div>
        </header>

        <main class="main-content">

            <div id="loading-section" class="section" style="display: flex;">
                <div class="loading-indicator">
                    <div class="loader" aria-label="Loading"></div>
                    <p>åˆå§‹åŒ–åœ°å›¾æ•°æ®ï¼Œè¯·ç¨å€™...</p>
                </div>
            </div>

            <div id="selection-section" class="section" style="display: block;">
                <div class="selection-grid">
                    <div class="selection-card">
                        <h3>é€‰æ‹©å¤œç‹</h3>
                        <p class="current-selection">å½“å‰é€‰æ‹©: <span id="chosen-nightlord">æœªé€‰æ‹©</span></p>
                        <div class="button-grid">
                            <button class="nightlord-btn" data-nightlord="Gladius">"é»‘å¤œé‡å…½"æ ¼æ‹‰ç‹„ä¹Œæ–¯</button>
                            <button class="nightlord-btn" data-nightlord="Adel">"é»‘å¤œä¹‹çˆµ"è‰¾å¾·é›·</button>
                            <button class="nightlord-btn" data-nightlord="Gnoster">"é»‘å¤œä¹‹æ™º"æ ¼è¯ºæ–¯å¡”</button>
                            <button class="nightlord-btn" data-nightlord="Maris">"æ·±æµ·é»‘å¤œ"ç›ä¸½æ–¯</button>
                            <button class="nightlord-btn" data-nightlord="Libra">"é»‘å¤œä¹‹é­”"åˆ©æ™®æ‹‰</button>
                            <button class="nightlord-btn" data-nightlord="Fulghor">"é»‘å¤œå…‰éª‘å£«"å¼—æ ¼å°”</button>
                            <button class="nightlord-btn" data-nightlord="Caligo">"é»‘å¤œé›¾éœ¾"å¡è‰æœ</button>
                            <button class="nightlord-btn" data-nightlord="Heolstor">"é»‘å¤œç‹"å¸ƒå¾·å¥‡å†¥</button>
                        </div>
                    </div>

                    <div class="selection-card">
                        <h3>é€‰æ‹©ç‰¹æ®Šåœ°å½¢</h3>
                        <p class="current-selection">å½“å‰é€‰æ‹©: <span id="chosen-map">æœªé€‰æ‹©</span></p>
                        <div class="button-grid">
                            <button class="map-btn" data-map="Default">é»˜è®¤</button>
                            <button class="map-btn" data-map="Mountaintop">å±±é¡¶</button>
                            <button class="map-btn" data-map="Crater">ç«å±±å£</button>
                            <button class="map-btn" data-map="Rotted Woods">è…è´¥æ£®æ—</button>
                            <button class="map-btn" data-map="Noklateo">éšåŸ</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
            <!-- ======================= -->
            
            <div class="map-header">
                <h3 class="instructions-card-title"><i class="fas fa-layer-group"></i>åœ°å›¾å±•ç¤º</h3>
                <div class="header-actions">
                    <button id="reset-map-btn" class="reset-btn">
                        <i class="fas fa-undo"></i>
                        é‡ç½®åœ°å›¾
                    </button>
                    <button id="toggle-poi-filter-btn" class="toggle-poi-btn" title="åˆ‡æ¢POIç­›é€‰">
                        å…´è¶£ç‚¹ç­›é€‰æ¨¡å¼ã€å·²å…³é—­ã€‘
                    </button>
                    <button id="clear-poi-btn" class="reset-btn" title="ç§»é™¤æ‰€æœ‰å…´è¶£ç‚¹">
                        <i class="fas fa-eraser"></i>
                        ç§»é™¤æ‰€æœ‰å…´è¶£ç‚¹
                    </button>
                </div>
            </div>

            <div class="instructions-card">
                <div id="interaction-section"  style="display: none;">

                </div>
            </div>

            <!-- ======================= -->
            <div id="results-section"  style="display: block;">
                <div class="results-grid">
                    <div class="left-panel">
                        <div class="instruction-grid">
                            <div class="instruction-item">
                                <i class="fas fa-mouse-pointer"></i>
                                <span>ä½¿ç”¨æ–¹æ³•ï¼šå·¦é”®æ ‡ç‚¹ï¼Œå³é”®åˆ é™¤</span>
                            </div>
                        </div>
                        <div class="seed-counter">
                            <h3>å¯èƒ½çš„åœ°å›¾ç§å­</h3>
                            <div class="seed-count" id="seed-count">0</div>
                        </div>
                        

                        <div id="possible-seeds-section" class="possible-seeds-section">
                            <div class="possible-seeds-card">
                                <h4><i class="fas fa-list"></i> æŸ¥çœ‹ä¸åŒåœ°å›¾ç§å­</h4>
                                <p class="description">æ”¯æŒæ–¹å‘é”®å¿«æ·åˆ‡æ¢</p>
                                <div id="possible-seeds-grid" class="possible-seeds-grid">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="map-container">
                        <canvas id="map-canvas" width="900" height="900"></canvas>
                        <div id="seed-image-container" style="display: none;"></div>
                        <div id="selection-overlay" class="selection-overlay">
                            <div class="overlay-message">
                                <i class="fas fa-map-marked-alt"></i>
                                <p>è¯·å…ˆåœ¨ä¸Šæ–¹é€‰æ‹©åœ°å›¾ä»¥å¼€å§‹</p>
                                <small>å¼€å¯å…´è¶£ç‚¹ç­›é€‰åå¯æ ‡æ³¨å¹¶ç¼©å°èŒƒå›´</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </main>
    </div>

    <!-- Help Modal -->
    <div id="help-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-question-circle"></i> åœ°å›¾ç­›é€‰å™¨ä½¿ç”¨æ•™ç¨‹</h3>
                <button class="close-btn" id="close-help">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h4><i class="fas fa-gamepad"></i> ä½¿ç”¨è¯´æ˜</h4>
                    <p>æœ¬å·¥å…·ç”¨äºå¿«é€Ÿæµè§ˆä¸ç­›é€‰ã€Šé»‘å¤œå›ä¸´ã€‹åœ°å›¾ç§å­ï¼šæ”¯æŒç›´æ¥æµè§ˆå…¨éƒ¨ç§å­ï¼Œæˆ–æŒ‰å¤œç‹/åœ°å›¾/å…´è¶£ç‚¹é€æ­¥ç¼©å°èŒƒå›´ã€‚</p>

                    <h4><i class="fas fa-list-ol"></i> å¿«é€Ÿä¸Šæ‰‹</h4>
                    <ol>
                        <li>ç›´æ¥æµè§ˆï¼šå·¦ä¾§â€œæŸ¥çœ‹ä¸åŒåœ°å›¾ç§å­â€åˆ—è¡¨é»˜è®¤å±•ç¤ºå…¨éƒ¨ç§å­ï¼Œç‚¹å‡»ä»»æ„ç¼–å·å³å¯æŸ¥çœ‹å¤§å›¾ï¼ˆæ–¹å‘é”®å¯åˆ‡æ¢ï¼‰ã€‚</li>
                        <li>æ¡ä»¶ç­›é€‰ï¼ˆå¯é€‰ï¼‰ï¼šå¯é€‰æ‹©<strong>å¤œç‹</strong>ä¸/æˆ–<strong>åœ°å›¾</strong>ä»¥ç¼©å°èŒƒå›´ï¼š
                            <ul>
                                <li>ä»…é€‰å¤œç‹ï¼šæ˜¾ç¤ºè¯¥å¤œç‹çš„å…¨éƒ¨ç§å­</li>
                                <li>ä»…é€‰åœ°å›¾ï¼šæ˜¾ç¤ºè¯¥åœ°å›¾çš„å…¨éƒ¨ç§å­</li>
                            </ul>
                        </li>
                        <li>å…´è¶£ç‚¹ç­›é€‰ï¼ˆå¯é€‰ï¼‰ï¼šå…ˆé€‰æ‹©åœ°å›¾ï¼Œå¼€å¯â€œå…´è¶£ç‚¹ç­›é€‰æ¨¡å¼â€ï¼Œåœ¨ç”»å¸ƒä¸Šç‚¹å‡»æ©™è‰²ç‚¹æ ‡æ³¨å®é™…çœ‹åˆ°çš„å†…å®¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤ç»“æœã€‚</li>
                    </ol>

                    <h4><i class="fas fa-lightbulb"></i> æ“ä½œæç¤º</h4>
                    <ul>
                        <li>æ ‡æ³¨ï¼šå·¦é”®æ‰“å¼€èœå•é€‰æ‹© æ•™å ‚/æ³•å¸ˆå¡”/æ‘è½ è¿›è¡Œæ ‡è®°ï¼›å³é”®åˆ é™¤æ ‡è®°ï¼›å¯ä½¿ç”¨â€œç§»é™¤æ‰€æœ‰å…´è¶£ç‚¹â€æ¸…ç©ºã€‚</li>
                        <li>ä¸º 0 æ¡ç»“æœæ—¶ï¼Œå¯é‡ç½®åœ°å›¾æˆ–å‡å°‘é™åˆ¶ã€‚</li>
                        <li>ç‚¹å‡»ç§å­å›¾ç‰‡å¯åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ã€‚</li>
                        <li>å¼€å¯å…´è¶£ç‚¹ç­›é€‰å‰éœ€å…ˆé€‰æ‹©ã€ç‰¹æ®Šåœ°å½¢ã€‘ã€‚</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Context Menu for Right Click -->
    <div id="poi-context-menu" class="context-menu" style="display: none;">
        <div class="context-menu-item" data-type="church">
            <img src="assets/images/church.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
            æ•™å ‚
        </div>
        <div class="context-menu-item" data-type="mage">
            <img src="assets/images/mage-tower.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
            æ³•å¸ˆå¡”
        </div>
        <div class="context-menu-item" data-type="village">
            <img src="assets/images/village.png" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;">
            å•†äººæ‘è½
        </div>
        <div class="context-menu-item" data-type="other">
            <i class="fas fa-question-circle"></i>
            å…¶ä»–å…´è¶£ç‚¹
        </div>
    </div>

    <footer class="footer">
        <p class="footer-text">
            <i class="fa-regular fa-heart" style="margin-right: 4px; color: #ff4d4f;"></i>
            Modified & Localized by <a class="footer-link" href="https://github.com/xxiixi" target="_blank">Cecilia</a> ï½œ
            <i class="fab fa-github" style="margin: 0 4px 0 8px;"></i>
            Forked from <a class="footer-link" href="https://github.com/thanosapollo/nightreign-mapseed-recogniser" target="_blank">thanosapollo/nightreign-mapseed-recogniser</a>
        </p>
        <p class="footer-text">
            Â© <span id="current-year">2025</span> NightreignMapFilter Â· All Rights Reserved Â· Last updated: <span id="last-updated">September 5, 2025</span>
        </p>
    </footer>

    <script>
        (function () {
            try {
                var yearEl = document.getElementById('current-year');
                var lastUpdatedEl = document.getElementById('last-updated');
                var statsBtn = document.getElementById('action-stats');
                var helpBtn = document.getElementById('help-btn');
                var statsPopover = document.getElementById('stats-popover');
                var repoBtn = document.getElementById('action-repo');
                var repoPopover = document.getElementById('repo-popover');
                var englishBtn = document.getElementById('action-english-web');
                var englishPopover = document.getElementById('english-popover');
                var mapSourceBtn = document.getElementById('action-map-source');
                var mapSourcePopover = document.getElementById('map-source-popover');
                var quickRefBtn = document.getElementById('action-quickref');
                var tbdPopover = document.getElementById('tbd-popover');
                var now = new Date();
                if (yearEl) {
                    yearEl.textContent = String(now.getFullYear());
                }
                var parsed = new Date(document.lastModified);
                if (!isNaN(parsed.getTime()) && lastUpdatedEl) {
                    var formatted = parsed.toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    lastUpdatedEl.textContent = formatted;
                }

                // ç®€æ˜“äº¤äº’ï¼šè®¿é—®é‡å¼¹å±‚ã€å¸®åŠ©å¼¹çª—ã€å¾…å®šå ä½
                if (statsBtn && statsPopover) {
                    statsBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        var willShow = statsPopover.style.display === 'none';
                        // äº’æ–¥ï¼šå¼€å¯å½“å‰å‰å…ˆå…³é—­å¯¹æ–¹
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                        statsPopover.style.display = willShow ? 'block' : 'none';
                    });
                    document.addEventListener('click', function () {
                        statsPopover.style.display = 'none';
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                    });
                    statsPopover.addEventListener('click', function (e) { e.stopPropagation(); });
                }

                if (helpBtn) {
                    helpBtn.addEventListener('click', function () {
                        var helpModal = document.getElementById('help-modal');
                        if (helpModal) helpModal.style.display = 'flex';
                    });
                }

                // é€ŸæŸ¥æ‰‹å†Œï¼šæ–°æ ‡ç­¾é¡µæ‰“å¼€
                if (quickRefBtn) {
                    quickRefBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        window.open('https://xxiixi.github.io/NightreignQuickRef/', '_blank', 'noopener,noreferrer');
                    });
                }

                // æŸ¥çœ‹æºç ï¼šå…ˆå¼¹å‡º Popoverï¼Œå†ç‚¹å‡»é“¾æ¥è·³è½¬
                if (repoBtn && repoPopover) {
                    repoBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        var willShow = repoPopover.style.display === 'none';
                        // äº’æ–¥ï¼šå¼€å¯å½“å‰å‰å…ˆå…³é—­å¯¹æ–¹
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                        repoPopover.style.display = willShow ? 'block' : 'none';
                    });
                    document.addEventListener('click', function () {
                        repoPopover.style.display = 'none';
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                    });
                    repoPopover.addEventListener('click', function (e) { e.stopPropagation(); });
                }

                // è‹±æ–‡ç«™ç‚¹ï¼šå¼¹å‡º Popoverï¼Œäº’æ–¥æ˜¾ç¤º
                if (englishBtn && englishPopover) {
                    englishBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        var willShow = englishPopover.style.display === 'none';
                        // äº’æ–¥ï¼šå¼€å¯å½“å‰å‰å…ˆå…³é—­å¯¹æ–¹
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                        englishPopover.style.display = willShow ? 'block' : 'none';
                    });
                    document.addEventListener('click', function () {
                        englishPopover.style.display = 'none';
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (mapSourcePopover) mapSourcePopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                    });
                    englishPopover.addEventListener('click', function (e) { e.stopPropagation(); });
                }
                if (mapSourceBtn && mapSourcePopover) {
                    mapSourceBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        var willShow = mapSourcePopover.style.display === 'none';
                        // äº’æ–¥ï¼šå¼€å¯å½“å‰å‰å…ˆå…³é—­å¯¹æ–¹
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                        mapSourcePopover.style.display = willShow ? 'block' : 'none';
                    });
                    document.addEventListener('click', function () {
                        mapSourcePopover.style.display = 'none';
                        if (statsPopover) statsPopover.style.display = 'none';
                        if (repoPopover) repoPopover.style.display = 'none';
                        if (englishPopover) englishPopover.style.display = 'none';
                        if (tbdPopover) tbdPopover.style.display = 'none';
                    });
                }
                if (mapSourcePopover) {
                    mapSourcePopover.addEventListener('click', function (e) { e.stopPropagation(); });
                }
            } catch (error) {
                console.error('Error initializing popovers:', error);
            }
        })();
    </script>
    <script src="data.js"></script>
    <script src="script.js"></script>
</body>
</html>
